---
title: "Write to GoogleDrive"
---

```{r}
library(googlesheets)
library(tidyverse)
```

## Coerse into GoogleSheet format

This file uses [library(googlesheet)](https://github.com/jennybc/googlesheets ) to write the data frames up to Google Drive as a Google Sheet. A data frame coerced into a format for Joel's workshop data stored on Google Drive.  

- From Google Drive, the Workshop presenter will be able to transfer information about attendence by putting x-marks in the Attendee columns (); one x for each rows-attendee
- Walk-in attendees, who are not on the waitlist, must be entered manually into the  google sheet.

### Process Event Metadata

```{r headerContent_Attendee}
eventMetaData_attendees <- attendees_header %>% 
  spread(X1, X2) 

eventDate <- mdy(
  str_split(
    eventMetaData_attendees$Date, ", ", 2
    )[[1]][2]
  )
```

### Combine Attendee & Waitlist 
```{r}
forGoogleDrive_attendees <- Attendees %>% 
  mutate("Workshop Name" = eventMetaData_attendees$Event) %>% 
  mutate("Workshop Date" = as.character(eventDate)) %>% 
  mutate("Attended" = "") %>% 
  mutate("Walk-in" = "") %>% 
  mutate("Waitlist" = "") %>% 
  select(`Attended`, `Walk-in`, `Waitlist`, list_type, `Workshop Date`,
         `Workshop Name`, `WorkshopID`, `First Name`,
         `Last Name`, `Email`, `Booking made`, 
         `Are you affiliated with Duke University?`,
         `Academic Status (or other)`,
         `Discipline or Affiliation`,
         `Institutes, Initiatives, or Program Affiliation`,
         `Where did you hear about this event?`,
         `Have you consulted with Data and Visualization Services before this workshop?`,
         `Would you like to receive more information about DVS events and training?`)

if("wait_list" %in% files$type){
  forGoogleDrive_WaitList <- WaitList %>% 
  mutate("Workshop Name" = eventMetaData_attendees$Event) %>% 
  mutate("Workshop Date" = as.character(eventDate)) %>% 
  mutate("Attended" = "") %>% 
  mutate("Walk-in" = "") %>% 
  mutate("Waitlist" = "") %>% 
  select(`Attended`, `Walk-in`, `Waitlist`, list_type, `Workshop Date`,
         `Workshop Name`, `WorkshopID`, `First Name`,
         `Last Name`, `Email`, `Booking made`, 
         `Are you affiliated with Duke University?`,
         `Academic Status (or other)`,
         `Discipline or Affiliation`,
         `Institutes, Initiatives, or Program Affiliation`,
         `Where did you hear about this event?`,
         `Have you consulted with Data and Visualization Services before this workshop?`,
         `Would you like to receive more information about DVS events and training?`)
}


if("wait_list" %in% files$type){
  forGoogleDrive_attendees <- bind_rows(
    forGoogleDrive_attendees,
    forGoogleDrive_WaitList
  ) %>% 
    arrange(`Last Name`)
} else {
  forGoogleDrive_attendees <- forGoogleDrive_attendees %>% 
    arrange(`Last Name`)
}
```

### Write to GoogleDrive 

Write as a GoogleSheet.  
```{r writeGoogSheets}

test1_ss <- gs_new(forGoogleDrive_attendees$`Workshop Name`[1], ws_title = "RegistrationsWaitlist", 
                   input = forGoogleDrive_attendees, col_names = TRUE,
                   trim = TRUE, verbose = TRUE)

# forGoogleDrive_Cancelled was created in the script: "process_libcal_attendance.Rmd"

if("cancelled" %in% files$type){
  test1_ss <- gs_ws_new(test1_ss, ws_title = "Cancellations", 
                        input = forGoogleDrive_Cancelled,
                        col_names = FALSE, trim = TRUE, 
                        verbose = TRUE)
}
```

## Write to GoogleSheet

## ToDo

1. write logic to arrange by "want more info" ; select email_address; write out as CSV or alternatively use gs_edit to update Joel's file.